name: ForgeRock
namespace: ForgeRock
image: okteto/node:14
command: bash
sync:
  - .:/usr/src/app
forward:
  - 9229:9229
  - 3000:3000
autocreate: true

build:
  todo-api:
    context: ./
    dockerfile: ./Dockerfile
    target: okteto.dev/base
    args:
      AM_URL: $AM_URL
      DEVELOPMENT: $DEVELOPMENT
      REALM_PATH: $REALM_PATH
      REST_OAUTH_CLIENT: $REST_OAUTH_CLIENT
      REST_OAUTH_SECRET: $REST_OAUTH_SECRET

  reactjs-todo:
    context: ./samples/reactjs-todo
    dockerfile: ./samples/reactjs-todo/Dockerfile
    target: okteto.dev/base
    args:
      AM_URL: $AM_URL
      API_URL: $API_URL
      DEBUGGER_OFF: $DEBUGGER_OFF
      REALM_PATH: $REALM_PATH
      JOURNEY_LOGIN: $JOURNEY_LOGIN
      JOURNEY_REGISTER: $JOURNEY_REGISTER
      WEB_OAUTH_CLIENT: $WEB_OAUTH_CLIENT
      REST_OAUTH_CLIENT: $REST_OAUTH_CLIENT
      REST_OAUTH_SECRET: $REST_OAUTH_SECRET
  angular-todo:
    context: ./
    dockerfile: ./samples/angular-todo/Dockerfile
    target: okteto.dev/base
    args:
      AM_URL: $AM_URL
      API_URL: $API_URL
      DEBUGGER_OFF: $DEBUGGER_OFF
      REALM_PATH: $REALM_PATH
      JOURNEY_LOGIN: $JOURNEY_LOGIN
      JOURNEY_REGISTER: $JOURNEY_REGISTER
      WEB_OAUTH_CLIENT: $WEB_OAUTH_CLIENT
      REST_OAUTH_CLIENT: $REST_OAUTH_CLIENT
      REST_OAUTH_SECRET: $REST_OAUTH_SECRET
  embedded-login:
    context: ./
    dockerfile: ./samples/embedded-login/Dockerfile
    target: okteto.dev/base
    args:
      AM_URL: $AM_URL
      REALM_PATH: $REALM_PATH
      SCOPE: $SCOPE
      TIMEOUT: $TIMEOUT
      TREE: $TREE
  mock-api:
    context: ./
    dockerfile: ./Dockerfile
    ports:
      - 9443
deploy:
  compose:
    - docker-compose.yml
  endpoints:
    - path: /reactjs-todo
      service: reactjs-todo
    - path: /angular-todo
      service: angular-todo
    - path: /embedded-login
      service: embedded-login
    - path: /mock-api
      service: mock-api
    - path: /todo-api
      service: todo-api
