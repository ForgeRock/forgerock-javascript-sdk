dev:
  todo-api:
    image: okteto/node:16
    command: bash
    sync:
      - .:/samples/todo-api
  reactjs-todo:
    image: okteto/node:16
    command: bash
    sync:
      - .:/samples/reactjs-todo
  angular-todo:
    image: okteto/node:16
    command: bash
    sync:
      - .:/samples/angular-todo
  embedded-login:
    image: okteto/node:16
    command: bash
    sync:
      - .:/samples/embedded-login
  mock-api:
    image: okteto/node:16
    command: bash
    sync:
      - .:/e2e/mock-api
  autoscript-apps:
    image: okteto/node:16
    command: bash
    sync:
      - .:/e2e/autoscript-apps
  autoscript-suites:
    image: okteto/node:16
    command: bash
    sync:
      - .:/e2e/autoscript-suites
build:
  base:
    context: ./
    dockerfile: ./Dockerfile
    args:
      AM_URL: $AM_URL
      DEVELOPMENT: $DEVELOPMENT
      REALM_PATH: $REALM_PATH
      REST_OAUTH_CLIENT: $REST_OAUTH_CLIENT
      REST_OAUTH_SECRET: $REST_OAUTH_SECRET
      API_URL: $API_URL
      DEBUGGER_OFF: $DEBUGGER_OFF
      JOURNEY_LOGIN: $JOURNEY_LOGIN
      JOURNEY_REGISTER: $JOURNEY_REGISTER
      WEB_OAUTH_CLIENT: $WEB_OAUTH_CLIENT

  reactjs-todo:
    context: ./samples/reactjs-todo
    dockerfile: ./samples/reactjs-todo/Dockerfile
    target: base
  angular-todo:
    context: ./
    dockerfile: ./samples/angular-todo/Dockerfile
    target: base
  embedded-login:
    context: ./
    dockerfile: ./samples/embedded-login/Dockerfile
    target: base
    args:
      AM_URL: $AM_URL
      REALM_PATH: $REALM_PATH
      SCOPE: $SCOPE
      TIMEOUT: $TIMEOUT
      TREE: $TREE
deploy:
  compose:
    - docker-compose.yml
  commands:
    - envsubst < .env.example > .env
    - okteto build -t AM_URL=$AM_URL okteto.dev/base .

  endpoints:
    - path: /reactjs-todo
      service: reactjs-todo
    - path: /angular-todo
      service: angular-todo
    - path: /embedded-login
      service: embedded-login
    - path: /mock-api
      service: mock-api
    - path: /todo-api
      service: todo-api
